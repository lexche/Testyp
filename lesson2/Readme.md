## Урок 2. Траблшутинг производительности в Linux.

Как понять, что "болит" у сервера? Какие ресурсы необходимо добавить? Какой процесс "съедает" те или иные ресурсы? Расскажем в этом уроке.

<p align="center">
<img src="https://github.com/lexche/Testyp/assets/95694325/805d0a76-1365-45c7-8f45-ca1413144492" width="500" height="500">
</p>

В ОС Linux есть встроенный "инструментарий" для сбора статистики о работе системы. Задача системного администратора уметь с этими инструменами работать, чтобы получать нужную информацию и правильно её интерпретировать. В большинстве случаев системного администратора интересуют 4 показателя: процессор, оперативная память, жёсткий диск и сеть.

Рассмотрим встроенные в ОС Linux утилиты, так как эти утилиты являются мощными инструментами для мониторинга системы в реальном времени. Они помогают администраторам систем и пользователям отслеживать ресурсы, процессы и работу системы, что позволяет быстро реагировать на изменения и оптимизировать работу системы.

Рассмотрим основные:


- Vmstat.

Стандартный вывод утилиты vmstat:

  ```bash
   vmstat

procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 0  0 122228 672268 600112 5426320    0    0     2    76    1    0  1  1 98  0  0
```
Использование vmstat с ключом -w для вывода расширенной информации.

Как вы можете заметить это общий набор информации, рассмотрим как мониторить каждый из компонентов: процессор, оперативная память, жёсткий диск, сетевая активность.

#### Процессор

- Top.

Стандартный вывод утилиты top:

  ```bash
   top
   ```

выглядит следующим образом:


![4 6 2](https://github.com/lexche/Testyp/assets/95694325/82048bc3-f884-4520-b759-edf60a475b96)



1. Запуск top и сортировка процессов по использованию CPU. Команда: top, нажатие Shift + P. Этот ключ позволяет сортировать процессы по использованию памяти. После нажатия Shift + m top будет отображать процессы в порядке убывания использования памяти.

2. Просмотр загрузки каждого ядра процессора в top. команда: top, нажатие 1 .Данная опция позволяет просматривать загрузку каждого ядра процессора отдельно, что полезно при мониторинге многоядерных систем.

#### Оперативная память

- Free

Команда free используется для отображения информации об использовании оперативной памяти и подкачки в системе.

1. Простой вывод информации:
   Запустите в терминале команду:

   ```bash
   free
   ```

   Это покажет общее количество, использованную, свободную и занятую оперативную память, а также информацию о подкачке.

2. Человекочитаемый формат:
   Для более удобного отображения в гигабайтах, использовайте ключ -h:

   ```bash
   free -h
   ```

   Это представит результаты в более понятном виде для человека.

3. -s
   Ключ -s позволяет отобразить дополнительные статистические данные о использовании оперативной памяти.

4. -t
   Ключ -t покажет итоговую строку суммарно по всем столбцам:

5. -l
   Ключ -l покажет информацию о буферах и кэше:

#### Жёсткий диск

- Df

Команда df (disk free) позволяет отображать информацию о доступном месте на диске.

1. Простой вывод информации:
   Запустите в терминале команду df:

   ```
    df
   Filesystem                        1K-blocks     Used Available Use% Mounted on
   tmpfs                                805892     1844    804048   1% /run
   /dev/mapper/ubuntu--vg-ubuntu--lv 102626232 36022944  61344024  37% /
   tmpfs                               4029448        0   4029448   0% /dev/shm
   tmpfs                                  5120        0      5120   0% /run/lock
   /dev/sda2                           1992552   257828   1613484  14% /boot
   /dev/sda1                           1098628     6220   1092408   1% /boot/efi
   tmpfs                                805888        0    805888   0% /run/user/1000

   ```

   Это покажет общее использование дискового пространства по каждой файловой системе на вашем компьютере.

2. Человекочитаемый формат:
   Для более удобного чтения, добавьте ключ -h:

   ```bash
   df -h
   ```

   Это представит результаты в удобном формате с использованием гигабайтов.

3. -a
   Ключ -a в команде df используется для отображения информации о всех файловых системах, включая те, которые обычно не отображаются по умолчанию.

   Пример:

   ```bash
   df -a
   ```

4. -T
   Ключ -T отображает тип файловой системы для каждой точки монтирования:

   ```bash
   df -T
   ```

5. -x
   Ключ -x позволяет исключить определенные типы файловых систем из отображения:

   ```bash
   df -x tmpfs
   ```

   Это исключит файловые системы типа tmpfs из вывода.

#### Сетевая активность

Встроенные утилиты могут дать минмальную информацию о сетевой активности ОС, например:

- Ip

Команда ip в ОС Linux предназначена для настройки сетевых интерфейсов, но так же может предоставить информацию, например:

1. ip route show
   С помощью ip route show можно просмотреть текущие маршруты IP-адресов на вашей системе.


2. ip -s link show
   Если вам нужно получить статистику о сетевых интерфейсах, вы можете использовать ключ -s для отображения дополнительной подробной статистики.

3. ip -s address show
   Аналогично, ключ -s можно использовать для отображения статистики по IP-адресам на каждом интерфейсе.

### Квиз

1. Вопрос: Какую информацию показывает команда free -m?
   a) Использование дискового пространства.
   b) Загрузку сетевых интерфейсов.
   c) Использование памяти в мегабайтах.
   d) Список текущих процессов.

   Правильный ответ: c) Использование памяти в мегабайтах.

2. Вопрос: Что отображает команда df -h в Linux?
   a) Информацию о текущих активных сетевых соединениях.
   b) Объем свободного места на диске в удобочитаемом формате.
   c) Список всех установленных программ и их версии.
   d) Статистику работы сетевых интерфейсов.

   Правильный ответ: b) Объем свободного места на диске в удобочитаемом формате.

3. Вопрос: Какие данные выведет команда ip route show?
   a) Информацию о текущих маршрутах IP-адресов на системе.
   b) Список всех установленных пакетов и их зависимостей.
   c) Статистику использования оперативной памяти.
   d) Список текущих процессов на компьютере.

   Правильный ответ: a) Информацию о текущих маршрутах IP-адресов на системе.

4. Вопрос: Что показывает команда top в Linux?
   a) Список всех файлов на компьютере.
   b) Загруженность процессора и памяти системы.
   c) Список всех установленных пакетов.
   d) Состояние сетевых интерфейсов.

   Правильный ответ: b) Загруженность процессора и памяти системы.
   
С инструментами понятно, но важно понимать, что они показывают и на что стоит обращать внимание в 1ю очередь. Давайте в этом разберёмся.
