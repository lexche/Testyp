## Урок 5. Соединить маршрутизаторы


В этом уроке мы покажем как настраивать сеть , когда наша сеть состоит из нескольких маршрутизаторов и подсетей. Маршрутизаторы должны знать друг о друге и о подсетях, которые находятся за маршрутизаторами, и давать возможность устройствам из разных подстей взаимодействовать друг с другом, если это необходимо.

В предыдущих уроках мы уже затрагивали виды маршрутизации: статическая и динамическая , но перед практикой обновим этим знания.

Статическая маршрутизация - это метод определения маршрутов на сетевом устройстве (маршрутизаторе) вручную, без использования динамических протоколов маршрутизации. Это означает, что администратор самостоятельно настраивает таблицу маршрутизации на устройстве, указывая, куда отправлять пакеты для доставки к заданному назначению.

Преимущества статической маршрутизации:

1. Простота и прозрачность: Статические маршруты легко понимать и настраивать, поскольку администратор точно знает, какие маршруты используются.
   
2. Предсказуемость: Поскольку маршруты устанавливаются вручную, они остаются неизменными, пока администратор не внесет изменения.
   
3. Меньшая нагрузка на процессор маршрутизатора: Поскольку нет необходимости в обмене информацией о маршрутах с другими маршрутизаторами, статическая маршрутизация оказывает меньшую нагрузку на процессор устройства.

Недостатки статической маршрутизации:

1. Несколько маршрутов: В средних и крупных сетях настройка и обновление статических маршрутов может быть сложной задачей, особенно если сеть имеет множество маршрутов и подсетей.
   
2. Отсутствие динамической адаптации: Статические маршруты не могут адаптироваться к изменениям в сети, таким как отказы узлов или изменения в топологии сети.

3. Масштабируемость: В крупных сетях использование статической маршрутизации может быть неэффективным и неудобным из-за необходимости ручного управления.

Статическая маршрутизация все еще широко используется в малых сетях, в виртуальных сетях, а также для конкретных специальных случаев или для настройки базовой доступности до других сетей.


Динамическая маршрутизация - это процесс автоматического обмена информацией о сети между маршрутизаторами с целью определения оптимальных маршрутов для передачи данных. Здесь не нужно вручную настраивать маршруты, так как маршрутизаторы сами обмениваются информацией о сетях, что облегчает процесс управления сетью.

Несколько протоколов динамической маршрутизации:

1. OSPF (Open Shortest Path First):
   OSPF - это протокол маршрутизации, который определяет оптимальные маршруты на основе стоимости связей (bandwidth). OSPF является протоколом класса link-state и используется для средних и крупных сетей. Для настройки OSPF в Cisco IOS используется команда router ospf. 

2. RIP (Routing Information Protocol):
   RIP - один из самых простых протоколов маршрутизации. RIP работает на основе расстояния (hop count) до целевой сети. Хотя он не обладает такой масштабируемостью, как OSPF, RIP легко настраивается и подходит для небольших сетей. 

3. BGP (Border Gateway Protocol):
   BGP - это протокол межсетевой маршрутизации, используемый провайдерами интернет-услуг и крупными корпоративными сетями. BGP принимает решения о пути на основе различных атрибутов, таких как AS-путь. Настройка BGP требует более глубоких знаний и обычно используется для соединения различных автономных систем.


Преимущества:

1. Адаптивность: Маршруты могут быстро реагировать на изменения в сети.
2. Масштабируемость: Эффективно для крупных сетей, где динамический поиск оптимальных маршрутов является важным.
3. Удобство обслуживания: Позволяет управлять большим количеством маршрутов более эффективно.

Недостатки:

1. Нагрузка: Может создавать дополнительную нагрузку на сеть из-за обмена информацией между маршрутизаторами.
2. Конфигурационная сложность: Требует знаний для правильной настройки протоколов маршрутизации.

Статическая маршрутизация предпочтительна в небольших сетях, где управление небольшим числом маршрутов важнее автоматизации и быстрой адаптации. Динамическая маршрутизация лучше подходит для крупных распределенных сетей, где эффективное управление маршрутами и быстрая реакция на изменения необходимы. 

В этом уроке, в его практической, мы будем использовать статическую маршрутизацию.

Давайте соберём тестовый стенд. Откроем Cisco Packer tracer. 

Добавим в рабочую зону 2 маршрутизатора и 2 устройства(например, компьютер и ноутбук):


![5 2 5 1](https://github.com/lexche/Testyp/assets/95694325/65bdd351-78e8-404a-8b14-22dfff54377b)

Соединим маршрутизатора между собой через интерфейсы FastEthernet0/0(далее 0/0), а интерфейсы FastEthernet0/1(далее 0/1) подключим к конечным устройствам.

![5 2 5 2](https://github.com/lexche/Testyp/assets/95694325/34c82d4c-c210-42e5-81f0-3e691059e885)

Красные треугольники показывают, что никто никого не видит. Давайте исправим это.

Начнём с описания того, что проговорим какие подсети будем использовать. У нулевого маршрутизатора интерфейс 0/1 будет иметь адрес 192.168.0.1 255.255.255.0 интерфейс 0/0 10.10.10.1 255.255.255.252 (Вопрос со звёздочкой: какую разрядность имеет подсеть с маской 255.255.255.252 и сколько адресов для хостов будет в этой сети?). У первого маршрутизатора интерфейс 0/1 будет иметь адрес 192.168.1.1 255.255.255.0 интерфейс 0/0 10.10.10.2 255.255.255.252 (Вопрос со звёздочкой: какую разрядность имеет подсеть с маской 255.255.255.252 и сколько адресов для хостов будет в этой сети?). 

Назначим IP-адреса на конечных устройствах: компютере (192.168.0.10) и ноутбуке (192.168.1.10).

Далее перейдём к настройкам маршрутизаторов. Пропишем на интерфейсах адреса, как описано выше.

Попробуем пропинговатьс компьютера (192.168.0.10) роутер 1(192.168.1.1):

```
C:\>ping 192.168.1.1

Pinging 192.168.1.1 with 32 bytes of data:

Reply from 192.168.0.1: Destination host unreachable.
Reply from 192.168.0.1: Destination host unreachable.
Reply from 192.168.0.1: Destination host unreachable.
Reply from 192.168.0.1: Destination host unreachable.

Ping statistics for 192.168.1.1:
    Packets: Sent = 4, Received = 0, Lost = 4 (100% loss)

```

Результат ожидаем - ответа нет. Давайте пропишем маршруты.

На роутере 0 заходим в терминал и вводим:

```
Router>enable 
Router#conf t
Enter configuration commands, one per line.  End with CNTL/Z.
Router(config)#ip route 192.168.1.0 255.255.255.0 10.10.10.2
Router(config)#exit
Router#
%SYS-5-CONFIG_I: Configured from console by console

Router#wr

```

Аналогично добавляем маршрут на 1м роутере.

После этого мы наблюдаем, что ноутбук и компьютер "видят" друг друга.

![5 2 5 3](https://github.com/lexche/Testyp/assets/95694325/aa3c4e7b-c846-48f9-b454-46fb80af4c28)


### Практическое задание.

Мы умышлено не стали детально описывать часть настроек, так как они были в предыдущих уроках.

Например, мы не упоминули команду no shutdown на роутерах, так как по умолчанию интерфейсы на маршрутизаторах "выключены", так же не стоит забывать, что на конечных устройствах нужно указывать шлюз по умолчанию.

Соберите самостоятельно аналогичный стэнд и сделайте "доступными" друг для друга конечные устройства.

---

Фаервол (Firewall) – это система безопасности, которая служит для контроля и фильтрации трафика внутри компьютерной сетью (или отдельным компьютером) и внешней сетью (интернетом) или внутри локальной сети. Он работает на уровне сетевого протокола и может быть как программным (на уровне операционной системы), так и аппаратным (например, маршрутизаторы с встроенными фаерволами).

Фаерволы необходимы для обеспечения безопасности сети. Они могут блокировать нежелательный трафик, фильтровать пакеты данных по различным критериям (например, IP-адрес, порт, протокол) и устанавливать правила доступа. Это помогает предотвращать атаки извне, защищать сеть от вредоносных программ, контролировать доступ к ресурсам и обеспечить общую безопасность сети.

Фаерволы защищают сеть от различных угроз, включая:

1. DDoS-атаки: Фаерволы могут блокировать атаки, направленные на перегрузку сети или сервера большим количеством запросов.
2. Хакерские атаки: Злоумышленники могут пытаться проникнуть в сеть, украсть данные, запустить вредоносное ПО и т.д. Фаерволы помогают предотвращать такие атаки.
3. Фишинг и мошенничество: Фаерволы могут блокировать доступ к вредоносным сайтам, предотвращая попытки кражи личной информации или финансовых данных сотрудников.
4. Защита от нежелательного контента: Фаерволы могут фильтровать трафик и блокировать доступ к определенным категориям сайтов (например, игровые сайты, социальные сети) в корпоративной сети.

Для примера возьмём наш предыдущий стэнд и добавим следующие строки на маршрутизаторе 0:

```
Router(config)# access-list 100 deny ip host 192.168.1.10 host 192.168.0.10
Router(config)# access-list 100 permit ip any any
Router(config)# interface FastEthernet0/0
Router(config-if)# ip access-group 100 in

```

Разберём что это всё значит по шагам:

1. Создание списка доступа для запрета доступа с хоста 192.168.1.10 к хосту 192.168.0.10:

   ```plaintext
   Router(config)# access-list 100 deny ip host 192.168.1.10 host 192.168.0.10
   ```

   - Router(config)#: Этот префикс указывает, что команда выполняется в режиме конфигурации на маршрутизаторе.
   - access-list 100: Создание расширенного списка доступа (ACL) с номером 100.
   - deny ip host 192.168.1.10 host 192.168.0.10: Запрещение трафика от хоста с IP-адресом 192.168.1.10 к хосту с IP-адресом 192.168.0.10.

2. Разрешение всего остального трафика с помощью правила permit any any:

   ```plaintext
   Router(config)# access-list 100 permit ip any any
   ```

   - access-list 100: Продолжение работы с ACL номер 100.
   - permit ip any any: Разрешение всех типов IP-трафика между любыми узлами в сети.

3. Применение ACL к интерфейсу FastEthernet0/0 для входящего трафика:

   ```plaintext
   Router(config)# interface FastEthernet0/0
   Router(config-if)# ip access-group 100 in
   ```

   - Router(config)# interface FastEthernet0/0: Переход к конфигурации интерфейса FastEthernet0/0 на маршрутизаторе.
   - ip access-group 100 in: Применение ACL с номером 100 для фильтрации входящего трафика на этом интерфейсе.

После этого доступ к устройству прекратиться:

```
C:\>ping 192.168.0.10

Pinging 192.168.0.10 with 32 bytes of data:

Reply from 10.10.10.1: Destination host unreachable.
Reply from 10.10.10.1: Destination host unreachable.
Reply from 10.10.10.1: Destination host unreachable.
Reply from 10.10.10.1: Destination host unreachable.

Ping statistics for 192.168.0.10:
    Packets: Sent = 4, Received = 0, Lost = 4 (100% loss),

```

Чтобы проверить, что правило работает только для этого устройства вы можете поменять сетевой адрес устройства и убедиться, что оно вновь стало доступно.

---

Вы никогда не задумывались как несколько десятков (сотен) устройств в организации получают доступ к ресурсам в интернете, имея один "внешний" адрес? Как сайты и приложения "понимают" кому и что отправлять? 

Для этих целей используется технология NAT.

NAT (Network Address Translation) — это технология, используемая в компьютерных сетях для преобразования IP-адресов между частными (локальными) и общедоступными IP-адресами. 

Основные функции NAT:

1. Экономия IP-адресов. NAT позволяет использовать меньшее количество публичных IP-адресов для подключения множества устройств с частными IP-адресами к Интернету. Это помогает справиться с ограниченным числом общедоступных IP-адресов и экономит их использование.

2. Защита частных IP-адресов. NAT скрывает частные IP-адреса устройств в локальной сети от внешнего интернета, что повышает безопасность, сокращая прямой доступ к устройствам извне.

3. Управление трафиком. NAT позволяет управлять потоком трафика, фильтровать его, создавать правила доступа и ограничивать доступ к ресурсам сети. Это способствует дополнительному контролю и безопасности в сети.

4. Поддержка IPv4. В условиях ограниченности IPv4-адресов NAT стал важным инструментом для обеспечения связности сетей и преодоления ограничений IPv4 в современных сетях.

Когда устройства из локальной сети открывают веб-сайт через NAT (Network Address Translation), происходит следующий процесс:

1. Запрос от устройства в локальной сети: Устройство в локальной сети (например, компьютер или смартфон) пытается открыть веб-сайт, оно отправляет запрос на доступ к этому сайту, указывая его доменное имя или IP-адрес.

2. Перевод частного IP в публичный IP: Маршрутизатор с NAT принимает запрос от устройства с частным IP-адресом и изменяет исходный IP-адрес (частный IP) на один доступный из пула общедоступных IP-адресов (публичный IP).

3. Отправка запроса на внешний ресурс: Теперь маршрутизатор с публичным IP-адресом отправляет запрос на открытие веб-сайта на сервер, опираясь на свой общедоступный адрес.

4. Получение данных и передача устройству в локальной сети: Сервер в интернете обрабатывает запрос, формирует страницу сайта и отправляет ее обратно по указанному публичному IP-адресу.
   
5. Пересылка данных обратно на устройство в локальной сети:  Маршрутизатор снова использует NAT для замены публичного IP-адреса в ответе на запрос обратно на частный IP-адрес устройства внутри локальной сети.

**Виды NAT (Network Address Translation)**

1. **Статический NAT (Static NAT):** Статический NAT устанавливает постоянное соответствие между частным IP-адресом устройства в локальной сети и публичным IP-адресом для обеспечения постоянной связи.

   **Пример:** Допустим, у вас есть веб-сервер с частным IP 192.168.1.2 в локальной сети, который должен быть доступен из Интернета по публичному IP-адресу 203.0.113.10. Статический NAT позволит установить постоянное соответствие между этими адресами, обеспечивая доступ к вашему веб-серверу извне.

2. **Динамический NAT (Dynamic NAT):** При динамическом NAT публичные IP-адреса назначаются динамически из пула доступных адресов при необходимости устройствам с частными IP-адресами.
   
   **Пример:** Можно представить, что у вас есть офисная сеть, в которой несколько компьютеров должны иметь доступ в Интернет. Динамический NAT разрешает им использовать общий набор публичных IP-адресов из пула для выхода в Интернет.

3. **PAT (Port Address Translation), также известный как Overloading NAT:** PAT - это разновидность NAT, которая использует один публичный IP-адрес для преобразования частных IP-адресов и портов.

   **Пример:** Если в вашей домашней сети несколько устройств пытаются выйти в Интернет одновременно, роутер с PAT может применить уникальные порты для каждого устройства, чтобы обеспечить их отличимость и допустить работу с одним публичным IP-адресом.



