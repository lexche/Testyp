## Урок 3. Системы мониторинга Zabbix, Prometheus и Grafana

В этом уроке мы перейдём от общего к частному. Поговорим о 3х популярных продуктах в области мониторинга ИТ-систем: Zabbix, Prometheus и Grafana.

#### Zabbix

Zabbix — это мощная система мониторинга и управления сетями, серверами и другими ИТ-ресурсами. Её основные возможности включают сбор данных о состоянии системы, отслеживание производительности, оповещения об ошибках и автоматизированные действия в случае проблем.

<p align="center">
<img src="https://github.com/lexche/Testyp/assets/95694325/4a8da54e-6c3a-4374-8b69-bed5a35d23ab">
</p>

Почему Zabbix так популярен? Вот несколько причин:

1. Открытое ПО: Zabbix — это open-source (с открытым исходным кодом) решение, что означает свободный доступ к коду, возможность расширения и адаптации под свои нужды. Это обеспечивает гибкость и независимость от поставщика.

2. Масштабируемость: Zabbix способен мониторить отдельные устройства до целых дата-центров. Он предоставляет возможность создания различных уровней мониторинга и отчетности для разных компонентов ИТ-инфраструктуры.

3. Богатые возможности: С Zabbix вы можете настраивать широкий спектр мониторинга, от простой проверки доступности серверов до сложных метрик производительности и аналитики данных. Это включает в себя графики, оповещения, отчеты и многое другое.

4. Сообщество поддержки: Zabbix имеет активное сообщество пользователей, разработчиков и экспертов, готовых помочь и поделиться опытом. Это делает это решение еще более привлекательным для новичков и опытных специалистов.

5. Интеграция и расширяемость: Zabbix может интегрироваться с другими системами и сервисами, такими как базы данных, облачные сервисы или системы управления контейнерами. Также существует возможность создания собственных скриптов и модулей для расширения функционала.

#### Prometheus

Prometheus - это система мониторинга и алертинга с открытым исходным кодом, разработанная для сбора метрик из различных систем, приложений и сервисов. Он позволяет наблюдать за состоянием вашей ИТ-инфраструктуры, отслеживать производительность, выявлять проблемы и отправлять уведомления об аномалиях. Вначале ее разрабатывали как инструмент для отслеживания контейнерных сред, но постепенно ее функциональность была расширена до того, чтобы охватить также приложения, сервера, базы данных и виртуальные машины.

<p align="center">
<img src="https://github.com/lexche/Testyp/assets/95694325/4305edfe-d8f5-4f0f-96c6-7caeea3e2eba">
</p>

Причина по которым Prometheus популярен:

1. Модель данных: Prometheus работает на основе многомерной модели данных, что означает возможность хранения временных рядов данных с неограниченным набором измерений. Это позволяет создавать гибкие и мощные запросы для анализа и визуализации данных.

2. Сбор данных: Prometheus легко интегрируется с различными приложениями и сервисами для сбора данных. Он поддерживает множество протоколов для сбора метрик, таких как HTTP, SNMP, или даже JMX.

3. Гибкий язык запросов: Prometheus предлагает PromQL (Prometheus Query Language) для выполнения сложных запросов к данным и создания пользовательских дашбордов и графиков. Этот язык дает возможность проводить глубокий анализ данных и метрик.

4. Масштабируемость: Prometheus разработан с учетом горизонтального масштабирования. Вы можете создать кластер из нескольких серверов Prometheus для сбора и обработки больших объемов данных.

5. Интеграция: Благодаря открытой архитектуре и множеству инструментов экосистемы Prometheus, он легко интегрируется с различными системами мониторинга, визуализации данных и оповещения.

#### Grafana

Grafana — это платформа для визуализации данных и мониторинга, которая позволяет создавать красивые и информативные дашборды для отображения различных метрик и данных из различных источников.

<p align="center">
<img src="https://github.com/lexche/Testyp/assets/95694325/c7fb90a4-e57b-4592-89d4-c5c2f408ba95">
</p>

 Особенности и плюсы Grafana:

1. Гибкость и удобство использования: Grafana предлагает интуитивно понятный интерфейс и широкие возможности настройки дашбордов. Вы легко можете создавать красочные графики, диаграммы, таблицы и другие элементы для визуализации данных.

2. Поддержка множества источников данных: Grafana интегрируется с различными источниками данных, включая Prometheus, InfluxDB, MySQL, PostgreSQL, AWS CloudWatch и многие другие. Это позволяет объединить данные из различных систем для централизованного мониторинга.

3. Оповещения и уведомления: Grafana поддерживает кастомизированные оповещения и уведомления об аномалиях или событиях. Это помогает оперативно реагировать на проблемы в ИТ-инфраструктуре.

4. Широкие возможности анализа данных: С помощью Grafana вы можете проводить анализ данных, создавать динамические запросы к данным, строить прогнозы и отслеживать тенденции.

5. Экосистема плагинов и расширений: Grafana имеет обширную экосистему плагинов и расширений, позволяющих расширить его функциональность и интегрироваться с дополнительными сервисами и инструментами.

6. Открытый исходный код: Как и многие популярные инструменты сейчас, Grafana открыт и может быть настроен и расширен по вашему усмотрению.

#### Квиз

Определите к какой из систем: Zabbix, Prometheus, Grafana относятся представленные особенности.


1. Вопрос: Какая система мониторинга использует PromQL для выполнения запросов к данным?

Ответ:
     Prometheus. PromQL (Prometheus Query Language) используется исключительно в Prometheus для выполнения сложных запросов к данным и создания пользовательских дашбордов и графиков.

2. Вопрос: Какая система мониторинга предлагает интеграцию с различными источниками данных, включая базы данных, облачные сервисы и системы управления контейнерами?

   Ответ:
     Grafana. Grafana предлагает широкие возможности интеграции с различными источниками данных, что позволяет объединить данные из различных систем для визуализации и мониторинга.

3. Вопрос: Какая система мониторинга характеризуется возможностью создания различных уровней мониторинга и отчетности для различных компонентов ИТ-инфраструктуры?
  
   Ответ:
   Zabbix. Zabbix способен мониторить отдельные устройства до целых дата-центров и предоставляет возможность настройки различных уровней мониторинга.

4. Вопрос: Какая система мониторинга обладает многомерной моделью данных для хранения временных рядов данных с неограниченным набором измерений?

   Ответ:
   Prometheus. Prometheus работает на основе многомерной модели данных, предоставляя возможность хранения временных рядов с неограниченным набором измерений.

---

Про установку Zabbix поговорим в следующем уроке, в этом же сконцентрируемся на теоретической части.

Начнём с архитектуры: 

-  Zabbix-сервер — это центральный компонент в инфраструктуре системы мониторинга Zabbix. Он отвечает за сбор, хранение, анализ и визуализацию данных, получаемых от Zabbix Agent'ов и Zabbix Proxy, а так же по протоколам: SNMP, IPMI, JMX и пр. Состоит из 3х подсистем: баз данных, которые хранят все данные, zabbix-сервера, которые собирает и обрабатывает данные, web-сервер для визуализации всех значений, настройки системы через браузер. 

- Zabbix-agent — это небольшое приложение, которое устанавливается на устройствах для сбора данных и передачи их на сервер Zabbix для мониторинга. Агент собирает информацию о системе, производительности, доступности сервисов и других метриках, которые важны для мониторинга состояния устройства.

- Zabbix Proxy — это промежуточное звено между удаленными местами и сервером Zabbix. Proxy обеспечивает сбор данных с удаленных узлов и их кэширование, а затем передачу данных на сервер Zabbix. Это позволяет уменьшить нагрузку на сервер Zabbix и улучшить производительность в случае большого количества удаленных узлов. Как правило, используется только в крупных высоконагруженных системах.

<p align="center">
<img src="https://github.com/lexche/Testyp/assets/95694325/f804ca88-c73b-48fc-b409-eb967ae0524d">
</p>

Итак, представим, что в нашей системе уже есть Zabbix-сервер: установлены необходимые компоненты, мы можем попасть на web-интерфейс мониторинга, несколько Zabbix-agent`ов на серверах настроены на передачу данных на Zabbix-сервер. 

Как думаете, наша система мониторинга уже работает?

Правильный ответ: нет.

<p align="center">
<img src="https://github.com/lexche/Testyp/assets/95694325/bee75deb-a310-4f44-8516-1df6f1eb46fa">
</p>

Агенты отправляют информацию о хосте на сервер, но на самом сервере нет информации об этих хостах, поэтому он не обрабатывает эту информацию. Подобно тому как на иллюстрации вода из трубы вытекает в никуда, так как не состыкована со второй частью, так и информация от агента системы мониторинга "выливается" в никуда. 

Давайте это исправим.

Начнём с объяснекния логики системы мониторинга Zabbix. Итак, у нас установлена серверная часть, администрирование доступно через web-браузер.

В предложенном выше сценарии, на хосте уже установлен и настроен zabbix-агент, но разберём и эту часть.

Подключимся по ssh к серверу, который планируем начать мониторить и установим zabbix-агент. В примере ОС ubuntu.

Устанавливаем zabbix-агент:

<p align="center">
<img src="https://github.com/lexche/Testyp/assets/95694325/6a64d4ac-8867-4667-8d2f-bf656638004d">
</p>

Далее изменим конфигурационный файл, добавив в него информацию о сервере(подробно об этом в следующем уроке).

Перезапустим службу агента и добавим её в автозагрузку:

```
sudo systemctl start zabbix-agent 
sudo systemctl enable zabbix-agent
```

Проверим состояние нашего агента:

<p align="center">
<img src="https://github.com/lexche/Testyp/assets/95694325/0b877727-9579-470f-b6c7-7285526b28cd">
</p>

Как можно увидеть, он "бегает".

Перейдём к серверной части, страница авторизации выглядит следующим образом:

<p align="center">
<img src="https://github.com/lexche/Testyp/assets/95694325/db3f5a54-37e1-4b15-97f4-dbe17020cbbb">
</p>

Введя логин и пароль, попадаем на начальную страницу:

<p align="center">
<img src="https://github.com/lexche/Testyp/assets/95694325/f568e6dd-6278-42ff-bf3b-283c59ae203e">
</p>

Обратим внимание на панель управления слева, раздел "Сбор данных":

<p align="center">
<img src="https://github.com/lexche/Testyp/assets/95694325/16da1e41-4652-4066-a707-29183d6050a8">
</p>

Объясним некоторые вкладки:

1. Узлы сети (Hosts). В этой вкладке отображаются все узлы сети (хосты), которые мониторятся в системе Zabbix. Каждый узел представляет отдельное устройство или приложение, для которого собирается информация и производится мониторинг. Здесь можно управлять добавлением, настройкой и мониторингом узлов сети, просматривать данные о производительности и статусе узлов.

2. Группы узлов сети (Host Groups). Группы узлов сети используются для организации узлов по логическим категориям или функциональным областям. Это упрощает управление и просмотр статистики для группы узлов. Здесь можно создавать и редактировать группы узлов, добавлять узлы в группы для организации и управления мониторингом.

3. Шаблоны (Templates). Шаблоны содержат предварительно настроенные элементы мониторинга, триггеры, графики и уведомления, которые можно применить к узлам сети для облегчения и стандартизации мониторинга. Здесь вы можете создавать, редактировать и применять шаблоны к узлам для обеспечения единообразия мониторинга.

4. Группы шаблонов (Template Groups). Группы шаблонов используются для организации шаблонов по определенным категориям или типам мониторинга. Это удобно для управления множеством шаблонов. Здесь можно создавать группы шаблонов, добавлять шаблоны в группы для их организации и управления, облегчая процесс настройки и применения шаблонов.

Добавим узел сети в нашу систему мониторинга.

Переходим во вкладку "Узлы сети" и нажимаем на кнопку в правом верхнем углу "Добавить узел":

<p align="center">
<img src="https://github.com/lexche/Testyp/assets/95694325/73686f5f-8110-407d-8ac2-a3571c292181">
</p>

В появившемся окне заполняем поля: 

<p align="center">
<img src="https://github.com/lexche/Testyp/assets/95694325/bf932e68-152e-4ef5-94af-064d22c0ea83">
</p>

- Имя узла сети. Название сервера в мониторинге, как правило, вписывается Hostname, чтобы было проще идентифицировать.

- Шаблоны. В Zabbix'e "из коробки" уже есть приличный пул шаблонов для популярных систем и устройств, которые уже содержат метрики и тригеры, для демонстрации используем один из предустановленных.

- Группы узлов сети. Как написано выше, для объединения хостов в логические группы. Группы создаются самостаятельно, по усмотрению администратора.

- Добавить. Добавляем интерфейс через который сервер будет опрашивать хост. Мы установили агент, поэтому выбираем Агент.

<p align="center">
<img src="https://github.com/lexche/Testyp/assets/95694325/ab4d99bd-9bac-4d8d-8b4c-8459f5e592fd">
</p>

Если всё сделано правильно, то сервер появится в узлах и в графе "Доступность" появится зелёный значок "ZBX":

![4 6 14](https://github.com/lexche/Testyp/assets/95694325/1c3f0085-bc54-47e9-9df6-f24921b7b382)

После этого в Панели управления переходим в раздел Последние данные, выбираем в Группы узлов сети ту группу, в которую добавили сервер, если в группе несколько серверов, то выбираем интересующий нас сервер и жмём кнопку Применить. Вы увидите данные о метриках сервера, которые уже успел передать агент:

![4 6 15](https://github.com/lexche/Testyp/assets/95694325/8964bf30-2650-413e-af2b-f626eb0b0d1b)

Если в этом же разделе мы перейдём в раздел Проблемы и повторим выбор недавно добавленного сервера, нажмём кнопку применить, то сервер мониторинга отобразит проблемы, которые он уже успел выявить, например:

![4 6 16](https://github.com/lexche/Testyp/assets/95694325/913cbbc7-a6b4-4c6a-a020-b5ead448f822)

Помимо мониторинга и фиксирования проблем у Zabbix есть множество других функций, перечислим основные:

- Отчеты и аналитика (Reports). Zabbix предоставляет возможность создания отчетов и аналитики для анализа данных и событий.

- Графики и диаграммы (Graphs). Zabbix позволяет создавать графики и диаграммы для визуализации данных о производительности и состоянии системы.

-  Интеграция с другими системами (Integration with Other Systems). Zabbix может интегрироваться с другими системами мониторинга, службами оповещения, облачными платформами и средствами управления, расширяя его возможности. Пример: Интеграция с Telegram для отправки уведомлений.

-  Пользовательские скрипты и расширения (User Scripts and Extensions). Zabbix позволяет создавать и использовать пользовательские скрипты и расширения для дополнительного функционала и интеграции с другими системами. Например, написание скрипта для мониторинга специфических метрик, которые не поддерживаются стандартными средствами Zabbix.

- Построение топологии сети. В Zabbix вы можете создавать узлы и группировать их в логические структуры, отображающие топологию вашей сети.

- Оповещение о происшествиях. Настройка уведомлений через различные каналы: почта, SMS, telegram и пр. при срабатывании событий или триггеров. Возможность определять условия срабатывания уведомлений, их приоритет и кому отправлять оповещения. 

---

Подробный разбор Prometheus будет в следу уроках, в этом же разберём основные функции Prometheus в сравнениии с Zabbix. 

#### Тип системы.

Zabbix является более традиционной системой мониторинга, ориентированной на сбор, хранение и анализ метрик для мониторинга всех аспектов ИТ-инфраструктуры.

Prometheus ориентирован на современные динамические среды, такие как контейнерные архитектуры, и предназначен для сбора метрик и мониторинга производительности.

#### Архитектура.

 Zabbix имеет централизованную архитектуру с агентами на целевых узлах, присылающими данные на сервер, где происходит их обработка и анализ.

 Prometheus имеет децентрализованную архитектуру, где он напрямую собирает данные со своих целей без постоянного присутствия агентов на них.

 #### Модель данных.

 Zabbix использует структурированные данные в формате ключ-значение для хранения информации о состоянии системы.

  Prometheus использует многомерную модель данных, где каждая метрика имеет набор ключ-значение пар для более гибкого и мощного анализа.

  #### Гибкость

 За счет широких возможностей конфигурации и настройки, Zabbix подходит для комплексных сред и предоставляет множество возможностей для настройки мониторинга.

 Prometheus обладает гибким языком запросов PromQL, который упрощает выполнение сложных анализов метрик и обеспечивает более гибкий подход к мониторингу.

  


