## Урок 3. Работа с файлами

В заключительном уроке этой темы мы поговорим о работе с файлами при помощи Python. Python взаимодействует с файлами с помощью встроенных функций и методов, которые обеспечивают различные операции чтения, записи и управления файлами. 

Ранее в этом курсе мы рассматривали дескрипторы файлов. Кратко напомним, дескриптор файла - это целое число, которое операционная система использует для идентификации открытого файла. Он представляет собой абстрактную ссылку на файл, позволяя программе взаимодействовать с ним.  

Он как шифр, который открывает доступ к файлу, не раскрывая его точное местоположение на компьютере. 

Как работают дескрипторы файлов:

1. Открытие файла: При обращении к файлу (чтение, запись, выполнение) операционная система проверяет наличие такого файла и, если он найден, создает дескриптор, который  "привязывается" к этому файлу. 

2. Использование дескриптора:  Дескриптор позволяет вам взаимодействовать с файлом, не зная его физического местоположения на диске.  Вы можете читать, записывать данные, менять атрибуты файла, используя только дескриптор.

3. Закрытие файла:  После завершения работы с файлом необходимо "отвязать" дескриптор от него. Это освобождает ресурсы системы и предотвращает нежелательные изменения файла.

Преимущества использования дескрипторов:

* Упрощение доступа к файлам: Программисту не нужно знать детали физического расположения файла на диске.

* Улучшенная безопасность:  Дескрипторы  делают доступ к файлам более безопасным, так как они не раскрывают  полный путь к файлу.

* Эффективное управление ресурсами:  Дескрипторы  помогают  оптимизировать  использование  файлов,  ограничивая  количество  открытых  файлов  одновременно.

В Python дескрипторы файлов используются "под капотом", и программист обычно не работает с ними напрямую. Python предоставляет более удобный и абстрактный способ работы с файлами через объекты file.

Рассмотрим основные функции в Python для работы с файлами:

#### 1. Функция open().

 Функция open() в Python используется для открытия файлов в различных режимах. Она позволяет читать, записывать и работать с содержимым файлов. Вот более подробное объяснение о функции open() с примерами:

 ```
open(file, mode='r', buffering=-1, encoding=None, errors=None, newline=None, closefd=True, opener=None)
```

- file: имя файла или путь к файлу.
  
- mode: режим открытия файла. По умолчанию используется режим чтения r (read). Другие режимы :

r (Read) - Открывает файл только для чтения. Если файла не существует, возникнет ошибка FileNotFoundError.

w (Write) - Открывает файл для записи. Если файл не существует, он будет создан. Если файл уже существует, он будет перезаписан, и старые данные будут удалены.

a (Append) - Открывает файл для добавления данных. Если файл не существует, он будет создан. Если файл уже существует, новые данные будут добавлены в конец файла.

b (Binary) - Указывает, что файл нужно обрабатывать как бинарный. Используется в сочетании с другими режимами, например, rb (чтение бинарных файлов) и wb (запись бинарных файлов).

r+ (Read and Write) - Открывает файл для чтения и записи. Если файла не существует, возникнет ошибка FileNotFoundError.

w+ (Write and Read) - Открывает файл для чтения и записи. Если файла не существует, он будет создан. Если файл уже существует, он будет перезаписан.

a+ (Append and Read) - Открывает файл для чтения и записи. Если файла не существует, он будет создан. Если файл уже существует, новые данные будут добавлены в конец файла, а также можно будет читать данные из файла.

- buffering: параметр, который определяет размер буфера для чтения или записи. Если buffering=0, то буферизация будет отключена.

- encoding: кодировка файла.

- errors: способ обработки ошибок при чтении или записи файла.

- newline: перевод строки.

- closefd: указывает, следует ли закрывать файловый дескриптор при закрытии файла.

- opener: функция, которая будет использоваться для открытия файла.

#### 2. Функция read().

Функция read() в Python используется для чтения данных из файла. Она позволяет считать все содержимое файла целиком или заданное количество символов. Давайте рассмотрим подробнее функцию read() с примерами и объяснениями.

Функция read() считывает содержимое файла от текущей позиции курсора до конца файла или указанного количества символов.

Функция read() считывает содержимое файла от текущей позиции курсора до конца файла или указанного количества символов. Если ничего не указано в скобках, метод read() считывает все содержимое файла.

 После использования метода read(), курсор в файле перемещается в конец считанного участка.
 
Использование функции read() позволяет получить данные из файла и работать с ними в программе.

1. Пример с чтением всего содержимого файла:

```
# Открываем файл для чтения
with open('example.txt', 'r') as file:
    content = file.read()
    print(content)
```

- В этом примере открывается файл 'example.txt' в режиме чтения ('r').
- Метод read() вызывается для чтения всего содержимого файла и сохранения его в переменную content.
- Содержимое файла выводится на экран с помощью print().

2. Пример с чтением определенного количества символов из файла:

with open('example.txt', 'r') as file:
    content = file.read(10)
    print(content)

- Здесь метод read(10) используется для чтения первых 10 символов из файла.
- Только первые 10 символов файла будут считаны и сохранены в переменной content.


Важно учитывать, что при работе с большими файлами, чтение целиком содержимого файла в память может быть неэффективным. В таких случаях лучше использовать чтение файла построчно или поблочно. Функция read() удобна для работы с небольшими файлами, когда требуется прочитать все содержимое целиком.

#### 3. Функция write().

Функция write() в Python используется для записи данных в файл. Она принимает один аргумент - строку, которую нужно записать в файл. Функция write() осуществляет запись в файл оттуда, где находится указатель позиции в файле. Если указатель находится в начале файла, то данные будут записаны в начало файла, а если указатель находится в конце файла, то данные будут добавлены в конец файла.

Пример использования функции write() для записи строки в файл:

```
# Открываем файл для записи
f = open("example.txt", "w")

# Записываем строку в файл
f.write("Hello, world!")

# Закрываем файл
f.close()
```

В приведенном примере мы открываем файл "example.txt" для записи (режим "w"), далее используем функцию write() для записи строки "Hello, world!" в файл, и наконец закрываем файл.

Если файл уже существует и содержит какие-то данные, то при использовании функции write() данные будут перезаписаны. Если же нужно добавить данные в конец файла, не затирая уже существующие данные, то можно открыть файл в режиме "a" (append) вместо "w".

```
# Открываем файл для добавления данных
f = open("example.txt", "a")

# Добавляем строку в конец файла
f.write("\nThis is a new line.")

# Закрываем файл
f.close()
```

В данном примере мы открываем файл "example.txt" для добавления данных (режим "a"), используем функцию write() чтобы добавить строку "This is a new line." в файл, и затем закрываем файл.

Функция write() очень полезна при работе с файлами, так как позволяет записать данные в файл в процессе выполнения программы.

#### 4. Функция close().

Функция close() в Python используется для закрытия файлов или объектов, которые поддерживают операции ввода-вывода. После того, как файл или объект закрыт, нельзя будет совершать операции ввода-вывода с ним.

Функция close() используется для освобождения ресурсов, связанных с файлами или объектами ввода-вывода. После закрытия, использовать данный ресурс становится невозможно.

Когда файл или объект закрывается, операционная система освобождает все выделенные для него системные ресурсы.

Не закрывая файлы или соединения с базой данных после использования, можно столкнуться с проблемами в работе программы из-за утечек памяти или недоступности ресурсов.

Ниже представлены примеры и объяснения использования функции close():

1. Закрытие файла

```
file = open("example.txt", "r")
content = file.read()
print(content)
file.close()  # Закрываем файл
```

В данном примере мы открываем файл "example.txt" в режиме чтения ('r'), считываем его содержимое и выводим на экран. После завершения работы с файлом, мы закрываем его с помощью функции close().

2. Закрытие соединения с базой данных

```
import sqlite3

# Устанавливаем соединение с базой данных
conn = sqlite3.connect('example.db')
cursor = conn.cursor()

# Выполняем какие-то операции с базой данных

conn.commit()
conn.close()  # Закрываем соединение с базой данных
```

В этом примере мы используем модуль sqlite3 для работы с базой данных SQLite. Мы устанавливаем соединение с базой данных, выполняем какие-то операции и затем закрываем соединение с помощью close().

Важно правильно использовать функцию close() после окончания работы с файлами или объектами, чтобы избежать возможных проблем с ресурсами.


