## Урок 1. Нереляционные базы данных

Нереляционные базы данных (NoSQL) - это тип баз данных, который не основан на традиционной реляционной модели, используемой в базах данных. Они предназначены для хранения и 
управления данными, которые не соответствуют жесткой схеме или структуре.

Например, реляционная база данных похожа на библиотеку, где книги организованы на полках по категориям или авторам. Каждая книга имеет уникальный идентификатор и может быть связана с другими книгами через общие темы или авторов, а нереляционная база данных похожа на склад, где товары хранятся в разных местах, без четкой организации по категориям или структуре. У каждого элемента есть уникальный идентификатор (например, штрих-код), но связи между элементами менее определены.

Концепция NoSQL возникла в конце 1990-х - начале 2000-х годов в ответ на растущее количество данных, которые не подходили для традиционных реляционных баз данных.

Ранние системы NoSQL, такие как Dynamo (Amazon) и Bigtable (Google), были разработаны для удовлетворения потребностей распределенных систем, таких как облачные вычисления и большие данные. Эти системы были спроектированы так, чтобы обеспечивать высокую доступность, горизонтальную масштабируемость и возможность работы с большими объемами неструктурированных данных.

 Термин "NoSQL" был придуман Эриком Брюэром, когда он описал эти новые системы как несоответствующие теореме CAP (согласованность, доступность, раздел переносимости).

 С момента своего появления NoSQL-базы данных стали широко использоваться в различных отраслях, включая электронную коммерцию, социальные сети, анализ больших данных и мобильную разработку.

Условия появления NoSQL:

• Масштабируемость: Быстрый рост Интернета и популярность веб-приложений привели к необходимости в базах данных, которые могли бы масштабироваться для обработки огромных объемов данных.

• Неструктурированные данные: Социальные сети, мобильные приложения и датчики генерируют большое количество неструктурированных или слабо структурированных данных, которые не подходят для реляционных баз данных.

• Распределенные системы: Облачные вычисления и распределенные системы потребовали баз данных, которые могли бы надежно работать на нескольких серверах и обеспечивать высокую доступность.

Ключевые отличия между реляционными и нереляционными:

• Структура: Реляционные базы данных имеют жесткую схему, которая определяет структуру данных, в то время как нереляционные базы данных не требуют схемы и могут хранить данные в различных форматах.

• Организация: Реляционные базы данных организуют данные в таблицы и строки, связанные через внешние ключи. Нереляционные базы данных обычно хранят данные в документах, ключах-значениях, графах или столбцах.

• Транзакции: Реляционные базы данных поддерживают транзакции (ACID), которые гарантируют целостность и точность данных. Нереляционные базы данных часто жертвуют транзакционностью ради более высокой производительности и масштабируемости.

• Масштабируемость: Реляционные базы данных обычно масштабируются вертикально (добавление более мощного оборудования), в то время как нереляционные базы данных предназначены для горизонтального масштабирования (добавление большего количества узлов в кластер).

 NoSQL базы данных разделяются на следующие категории:

 #### Документно-ориентированные базы данных

• Определение: Хранят данные в виде документов, которые могут содержать различные типы данных и иметь иерархическую структуру.

• Характеристики: Динамические схемы, индексация по полям и значениям, языки запросов, оптимизированные для работы с документами.

• Примеры: MongoDB, CouchDB, RavenDB

 #### Графовые базы данных

• Определение: Хранят данные в виде графов, где вершины представляют сущности, а ребра - отношения между ними.

• Характеристики: Эффективные алгоритмы для обработки запросов, ориентированных на графы, поддержка транзакций в некоторых случаях.

• Примеры: Neo4j, Titan, OrientDB

 #### Базы данных ключ-значение

• Определение: Хранят данные в виде пар ключ-значение, где ключ однозначно идентифицирует значение.

• Характеристики: Быстрый поиск на основе ключей, поддержка распределенных систем, ограниченные возможности запросов.

• Примеры: Redis, DynamoDB, Cassandra (также используется как колоночная база данных)

 #### Колоночные базы данных

• Определение: Хранят данные в столбцах, а не в строках, как реляционные базы данных.

• Характеристики: Оптимизированы для аналитических запросов, быстрая выборка по столбцам, поддержка больших объемов данных.

• Примеры: Apache Cassandra, HBase, Google Bigtable

Различия:

• Модель данных: Документно-ориентированные базы данных хранят данные в документах, графовые - в графах, базы данных ключ-значение - в парах ключ-значение, а колоночные - в столбцах.

• Структура данных: Документно-ориентированные и графовые базы данных имеют гибкую структуру, базы данных ключ-значение - простую структуру пар ключ-значение, а колоночные базы данных - табличную структуру, оптимизированную для столбцов.

• Операции: Документно-ориентированные базы данных поддерживают запросы к документам, графовые базы данных - запросы к графам, базы данных ключ-значение - поиск по ключам, а колоночные базы данных - аналитические запросы к столбцам.

• Масштабируемость: Все типы NoSQL-баз данных поддерживают горизонтальную масштабируемость, но колоночные базы данных особенно хорошо подходят для обработки больших объемов данных.

• Поддержка ACID: Некоторые базы данных ключ-значение и колоночные базы данных поддерживают транзакции ACID, в то время как документно-ориентированные и графовые базы данных обычно не поддерживают.

Применение:

• Документно-ориентированные: Хранение сложных документов, таких как профили пользователей и публикации в блогах.

• Графовые: Представление и запросы связей между сущностями, таких как социальные сети и сети знаний.

• Ключ-значение: Кэширование данных, быстрый поиск по идентификаторам, сеансы пользователей.

• Колоночные: Хранение и анализ больших объемов данных, таких как журналы серверов и данные сенсоров.

### Квиз

1. Какой из следующих вариантов является характеристикой NoSQL-баз данных?

a) Поддержка транзакций ACID

b) Жесткие схемы данных

c) Горизонтальная масштабируемость

d) Вертикальная масштабируемость

Правильный ответ: c). Объяснение: NoSQL-базы данных известны своей горизонтальной масштабируемостью, позволяющей добавлять больше узлов в кластер.

2. К какому типу NoSQL-баз данных относится MongoDB?

a) Графовая

b) Документно-ориентированная

c) Ключ-значение

d) Колоночная

Правильный ответ: b). Объяснение: MongoDB - это документно-ориентированная база данных, которая хранит данные в виде документов JSON.

3. Какую модель данных использует Redis?

a) Иерархическая

b) Пар ключ-значение

c) Графовая

d) Колоночная

Правильный ответ: b). Объяснение: Redis - это база данных ключ-значение, которая хранит данные в виде пар ключ-значение.

4. Какое преимущество NoSQL-баз данных перед реляционными базами данных?

a) Лучшая производительность

b) Более высокая надежность

c) Гибкость и масштабируемость

d) Поддержка всех типов данных

Правильный ответ: c). Объяснение: NoSQL-базы данных известны своей гибкостью и возможностями масштабирования, что делает их идеальным выбором для обработки больших объемов неструктурированных или слабо структурированных данных.

___

В этой теме мы подробно остановимся на MongoDB, которая относится к документо-ориентированным нереляционным БД.

Проект MongoDB был основан в 2007 году Двайтом Мериманом, Элиотом Хоровицем (не путать с Воловитцем, шутка) и Кевином МакКоннеллом.

Версии MongoDB:

MongoDB 1.0 (2009)

• Первая стабильная версия MongoDB.

• Введено понятие коллекций и документов.

• Поддержка запросов JSON и индексов.

MongoDB 2.0 (2011)

• Улучшена производительность и масштабируемость.

• Введена поддержка репликации и автоматического переключения.

• Добавлены составные индексы и запросы с сортировкой.

MongoDB 2.2 (2013)

• Введено понятие вторичных реплик.

• Поддержка запросов с ограничением.

• Улучшена поддержка индексов и кеширования.

MongoDB 2.4 (2014)

• Введены запросы с агрегацией.

• Поддержка геопространственных запросов.

• Улучшенная поддержка управления памятью.

MongoDB 3.0 (2015)

• Введен полнотекстовый поиск.

• Поддержка управления пользователями и ролями.

• Улучшена поддержка распределенных систем.

MongoDB 3.2 (2016)

• Введены транзакции с множеством документов.

• Поддержка репликации с отслеживанием изменений.

• Улучшенная поддержка облачных сред.

MongoDB 3.4 (2017)

• Введены коллекции с ограниченным во времени существованием.

• Поддержка запросов с проецированием.

• Улучшенная поддержка JSON Schema.

MongoDB 3.6 (2018)

• Введены запросы с индексацией текста.

• Поддержка шифрования на стороне сервера.

• Улучшенная поддержка кластеров с несколькими регионами.

MongoDB 4.0 (2019)

• Введены функции автоматической индексации.

• Поддержка распределенных транзакций.

• Улучшенная производительность и масштабируемость.

MongoDB 4.2 (2020)

• Введены запросы с фацетированием.

• Поддержка репликации с состоянием до опции.

• Улучшенная поддержка MongoDB Atlas.

MongoDB 4.4 (2021)

• Введен механизм индексации на основе графов.

• Поддержка обновлений с отслеживанием изменений.

• Улучшенная поддержка кластеров с несколькими облаками.

MongoDB 5.0 (2022)

• Введены унифицированные представления.

• Поддержка агрегации с гранулированием по времени.

• Улучшенная поддержка для развертываний без сервера.

##### Основные особенности MongoDB.

Модель данных:

• Документы хранятся в коллекциях.

• Документы имеют динамическую структуру, состоящую из пар ключ-значение.

• Документы могут быть вложенными, что позволяет создавать сложные структуры данных.

Язык запросов:

• MongoDB использует запросы JSON-подобные запросы для поиска и выборки данных.

• Запросы могут быть сложными и могут использоваться для поиска вложенных документов.

• Запросы обрабатываются на стороне сервера, что обеспечивает высокую производительность.

Индексация:

• MongoDB поддерживает индексацию для повышения производительности запросов.

• Индексы могут быть созданы по любому полю документа.

• Индексы могут быть составными, что позволяет выполнять поиск по нескольким полям.

Репликация и отказоустойчивость:

• MongoDB поддерживает репликацию для высокой доступности и отказоустойчивости.

• Репличные наборы обеспечивают резервирование данных и автоматическое переключение при сбоях.

Другие особенности:

• Агрегация данных. Агрегация данных в MongoDB позволяет объединять данные из нескольких документов и выполнять операции над ними для получения полезной информации. Агрегация выполняется с использованием операторов конвейера агрегации, которые включают в себя:

1. $match: Фильтрация документов на основе заданных критериев.

2. $group: Группировка документов по общему полю и выполнение операций над группами (например, подсчет, суммирование).

3. project: Выбор и преобразование полей, которые будут включены в вывод.

4. $sort: Сортировка документов на основе заданных полей.

5. $limit: Ограничение количества возвращаемых документов.

• Полнотекстовый поиск. MongoDB поддерживает полнотекстовый поиск, позволяя выполнять поиск по тексту, хранящемуся в документах. Индекс полнотекстового поиска создается на полях, содержащих текст, и позволяет выполнять быстрые и эффективные поисковые запросы.

• Управление пользователями и ролями. MongoDB предоставляет систему управления пользователями и ролями для контроля доступа к базе данных и коллекциям. Пользователи могут быть созданы с различными ролями, каждая из которых имеет определенный набор привилегий. Это позволяет управлять доступом на уровне коллекции, документа и поля.

• Масштабируемость и распределенность. MongoDB может быть развернута в распределенной среде с использованием кластеров. Кластеры обеспечивают масштабируемость и отказоустойчивость, распределяя данные по нескольким серверам.

MongoDB поддерживает несколько архитектур кластеров, включая:

a. Репликационный набор - это группа из нескольких узлов MongoDB, которые содержат копию одного и того же набора данных. Один узел назначается первичным, а остальные - вторичными.  Обеспечивают высокую доступность и отказоустойчивость путем репликации данных на нескольких серверах.

b. Шардированные кластеры - это группа из нескольких узлов MongoDB, которые совместно хранят данные, разделенные на несколько фрагментов (шардов). Каждый узел содержит подмножество шардов. Запросы к шардированному кластеру направляются на соответствующий узел на основе ключа распределения, который определяет, в каком шарде хранятся данные. Обеспечивают горизонтальную масштабируемость путем разделения данных на несколько шардов (фрагментов).

c. Глобальные кластеры - это группа из нескольких репликационных наборов, развернутых в разных географических регионах. Данные реплицируются между репликационными наборами, обеспечивая географическую распределенность и сокращая задержку для пользователей, находящихся в разных местах. 


##### Достоинства MongoDB

• Гибкость и расширяемость: MongoDB использует динамическую схему, позволяющую хранить данные в гибких и неструктурированных форматах. Это упрощает работу с меняющимися данными и устраняет необходимость заранее определять строгую структуру данных.

• Хранение документов как единиц: MongoDB хранит целые документы как единицы, что упрощает извлечение и обработку данных. Это особенно полезно для приложений, которым требуется доступ к полным документам для принятия решений или выполнения операций.

• Вложенные структуры: MongoDB позволяет создавать вложенные документы, что упрощает моделирование сложных отношений между данными. Это устраняет необходимость создавать дополнительные таблицы или использовать сложные запросы для связывания данных.

• Поддержка JSON: MongoDB использует JSON (JavaScript Object Notation) в качестве формата данных. JSON является популярным и общепринятым форматом, что упрощает интеграцию с другими системами и приложениями.

• Высокая производительность: MongoDB оптимизирована для работы с большими объемами данных и обеспечивает высокую производительность для запросов и операций записи. Ее горизонтально масштабируемая архитектура позволяет распределять данные по нескольким серверам, что обеспечивает дальнейшее повышение производительности.

##### Недостатки MongoDB

• Неэффективность для отношений "многие ко многим": MongoDB неэффективно хранит отношения "многие ко многим" из-за ее структуры, ориентированной на документы. Для таких отношений может потребоваться дополнительная денормализация или использование отдельной коллекции для хранения ссылок.

• Менее эффективна для определенных типов запросов: MongoDB может быть менее эффективной для запросов, требующих сложных соединений или агрегаций с участием больших объемов данных. Для таких запросов может потребоваться дополнительная оптимизация или использование альтернативных баз данных.

• Менее зрелая, чем реляционные базы данных: MongoDB является относительно молодой базой данных по сравнению с реляционными базами данных, такими как MySQL и Oracle. В ней может быть меньше функций и инструментов, доступных для управления данными и обеспечения соответствия требованиям.

• Проблемы с целостностью данных: Динамическая схема MongoDB может потенциально привести к проблемам с целостностью данных, поскольку не существует строгого механизма обеспечения соответствия данных определенной структуре. Это может быть проблемой для приложений, требующих высокой степени целостности данных.

• Ограниченная поддержка ACID-транзакций: MongoDB поддерживает транзакции с одним документом, но не обеспечивает полную поддержку всех свойств ACID (согласованность, изоляция, долговечность). Это может быть недостатком для приложений, требующих сильной гарантии целостности транзакций.


### Квиз

1. Какой из следующих форматов данных используется в MongoDB?

a) XML

b) JSON

c) CSV

d) YAML

Правильный ответ: b. Объяснение: MongoDB использует JSON (JavaScript Object Notation) как формат данных для хранения документов. JSON является общепринятым и удобным форматом, упрощающим интеграцию с другими системами и приложениями.

2. Какая из следующих операций поддерживается в MongoDB?

a) Агрегация данных

b) Полнотекстовый поиск

c) Геопространственные запросы

d) Все вышеперечисленное

Правильный ответ: d. Объяснение: MongoDB поддерживает все перечисленные операции. Агрегация данных позволяет объединять и обрабатывать данные из нескольких документов. Полнотекстовый поиск позволяет выполнять поиск по тексту, хранящемуся в документах. Геопространственные запросы позволяют выполнять запросы на основе географических данных.

3. Какая из следующих архитектур кластеров поддерживается MongoDB?

a) Репликационные наборы

b) Шардированные кластеры

c) Глобальные кластеры

d) Все вышеперечисленное

Правильный ответ: d. Объяснение: MongoDB поддерживает все перечисленные архитектуры кластеров. Репликационные наборы обеспечивают высокую доступность и отказоустойчивость путем репликации данных на нескольких серверах. Шардированные кластеры обеспечивают горизонтальную масштабируемость путем разделения данных на несколько шардов (фрагментов). Глобальные кластеры обеспечивают географическую распределенность данных с автоматическим переключением в случае сбоя.

4. Какая из следующих функций MongoDB упрощает выполнение сложных запросов?

a) Язык запросов, похожий на JSON
b) Операторы конвейера агрегации
c) Поддержка полнотекстового поиска
d) Все вышеперечисленное

Правильный ответ: d. Объяснение: Язык запросов, похожий на JSON, упрощает создание запросов. Операторы конвейера агрегации позволяют выполнять сложные операции обработки данных. Поддержка полнотекстового поиска упрощает поиск документов по тексту, хранящемуся в полях.
